function SetupYaml(){
    # Install required module if not already installed
    if (-not (Get-Module -Name PowerShellYaml -ListAvailable)) {
        Install-Module -Name powershell-yaml -Scope CurrentUser -Force
    }
    # Import the required module
    Import-Module -Name powershell-yaml
}

#
# https://docs.oracle.com/en/virtualization/virtualbox/6.0/user/vboxmanage-unattended.html
#
function SetupVMSettings(){
    SetupYaml

    $configPath = "windows/vm_config.yml"
    $yamlContent = Get-Content -Path $configPath -Raw

    # Convert YAML to PowerShell objects
    $yamlData = ConvertFrom-Yaml -YamlContent $yamlContent
    $VMConfigs = [PSCustomObject]@{
        Name = $yamlData.VMName
        Memory = $yamlData.VMMemory
        DiskSize = $yamlData.VMDiskSize
        ISOPath = $yamlData.ISOPath
        Username = $yamlData.VMUsername
        Password = $yamlData.VMPassword
        Hostname = $yamlData.VMHostname
        Locale = $yamlData.VMLocale
        Country = $yamlData.VMCountry
        DiskPath = $yamlData.VMDiskPath
        Snapshot = $yamlData.VMSnapshot
    }
    return $VMConfigs
}

SetupVMSettings
<#
function VMSettings(){
    $VMConfigs = [PSCustomObject]@{
        username = ""
        password = ""
        locale = ""
        hostname = ""
        timezone = ""
    }

    $VMConfigs.username = Read-Host "Enter VM Username:"
    $VMConfigs.password = Read-Host "Enter VM Password:" -AsSecureString
    $VMConfigs.locale = Read-Host "Enter VM Locale:"
    $VMConfigs.hostname = Read-Host "Enter VM Hostname:"
    $VMConfigs.timezone = Read-Host "Enter VM Timezone:"

    return $VMConfigs
}

function CreateVM([PSCustomObject] $config){
    $config = VMSettings

# Create the VM
    VBoxManage createvm --name $vm_name --ostype Ubuntu_64 --register
    VBoxManage modifyvm $vm_name --memory $ram_size
    VBoxManage createhd --filename $vdi_path --size $disk_size
    VBoxManage storagectl $vm_name --name "SATA Controller" --add sata --controller IntelAHCI
    VBoxManage storageattach $vm_name --storagectl "SATA Controller" --port 0 --device 0 --type hdd --medium $vdi_path
    VBoxManage storagectl $vm_name --name "IDE Controller" --add ide
    VBoxManage storageattach $vm_name --storagectl "IDE Controller" --port 0 --device 0 --type dvddrive --medium $path_to_iso


    VBoxManage unattended install $VM `
    --iso=$path_to_iso `
    --user=$config.username --password $config.password `
    --install-additions --time-zone=$config.timezone `
    --hostname=$config.hostname `
    --locale=$config.locale


    # Start the VM and install Ubuntu
    VBoxManage startvm $vm_name --type headless
    Write-Host "Waiting for the VM to start..."
    Start-Sleep -Seconds 60
}
#>