function ReadVagrantConfig() {
    $jsonFilePath = ".\deploy\vagrant\vagrant-config.json"
    $config = Get-Content -Path $jsonFilePath -Raw | ConvertFrom-Json

    return $config
}

function ReadServiceTemplate(){
    $serviceTemplateFilePath = ".\deploy\vagrant\service_template.txt"
    $config = Get-Content -Path $serviceTemplateFilePath -Raw

    return $config
}

function SetupApps(){
    $config = ReadVagrantConfig
    $serviceTemplate = ReadServiceTemplate
    
    foreach ($AppConfig in $config.Apps.AppConfig){
        $servicePath = ".\deploy\vagrant\" + $AppConfig.Service.ServiceName + ".service"
        $content = $serviceTemplate `
        -replace ("{{ServiceDescription}}"), $AppConfig.Service.ServiceDescription `
        -replace ("{{ServiceWorkingDirectory}}"), $AppConfig.Service.WorkingDirectory `
        -replace ("{{ServiceExecStart}}"), $AppConfig.Service.ExecStart `
        -replace ("{{ServiceExecStop}}"), $AppConfig.Service.ExecStop
        
        Set-Content -Path $servicePath -Value $content
    }
    
    #Write-Host $config.Apps.AppConfig.Service.ServiceDescription
    #if ($config.Apps.AppConfig.Service.ServiceDescription)

    
    #$vagrantBuildPath = $config.Apps.AppConfig.DestinationFolder + $config.Apps.AppConfig.DeployFolder 
    #Write-Host "Deploying" $config.Apps.AppConfig.Service.ServiceName
    #git clone $config.Apps.AppConfig.Repo $config.Apps.AppConfig.DestinationFolder
    #cd $vagrantBuildPath
    #vagrant up
}

SetupApps