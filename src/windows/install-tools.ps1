Write-Host " __      __  _________________________ " -ForegroundColor White -BackgroundColor DarkRed
Write-Host "/  \    /  \/  _  \__    ___/\_____   \" -ForegroundColor White -BackgroundColor DarkYellow
Write-Host "\   \/\/   /  /_\  \|    |      /   __/" -ForegroundColor White -BackgroundColor DarkGreen
Write-Host " \        /    |    \    |     |   |   " -ForegroundColor White -BackgroundColor DarkCyan
Write-Host "  \__/\  /\____|__  /____|     |___|   " -ForegroundColor White -BackgroundColor DarkBlue
Write-Host "       \/         \/           <___>   " -ForegroundColor White -BackgroundColor DarkMagenta
Write-Host "---------------------------------------"
Write-Host "            WebApp Toolkit              "
Write-Host "        Use at your own risk!!!        "
Write-Host "---------------------------------------"

$packages = @(
    "PortSwigger.BurpSuiteCommunity",
    "Microsoft.VisualStudioCode",
    "Google.Chrome",
    "Microsoft.OpenJDK.17",
    "Oracle.JavaRuntimeEnvironment",
    "Git.Git",
    "GoLang.Go.1.20",
    "Docker.DockerDesktop",
    "Postman.Postman",
    "Microsoft.VCRedist.2015+.x64",
    "Oracle.VirtualBox",
    "Hashicorp.Vagrant"
)

function Install-Packages{
    foreach ($package in $packages) {
        Write-Host "Installing package: $package"
        winget install --accept-source-agreements --silent -e --id $package
    }
}

function Install-WSL{
    Write-Host "Installing WSL..."
    # Enable WSL feature
    Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux
    # Enable Virtual Machine feature
    Enable-WindowsOptionalFeature -Online -FeatureName VirtualMachinePlatform

    Write-Host "Setting Up Ubuntu - This will need a restart!"
    winget install -e --id kalilinux.kalilinux
}

function Install-ZAP{
    Write-Host "Installing OWASP ZAP..."
    Invoke-WebRequest "https://github.com/zaproxy/zaproxy/releases/download/v2.10.0/ZAP_2.10.0_windows-x64.exe" -OutFile "$env:TEMP\ZAPInstaller.exe"
    Start-Process -FilePath "$env:TEMP\ZAPInstaller.exe" -ArgumentList '/S' -Wait
}

function Set-Up-BurpSuiteCommunity{
    Write-Host "Burp Suite Community [2/3] - Setting up Burp Suite Community..."
    # Define the path to the Burp Suite Community Edition executable
    $burpPath = "$env:PROGRAMFILES\BurpSuiteCommunity\BurpSuiteCommunity.exe"

    # Setting Jython for Burp Suite extensions
    Invoke-WebRequest https://repo1.maven.org/maven2/org/python/jython-installer/2.7.3/jython-installer-2.7.3.jar -OutFile "$env:TEMP\jython-2-7-3.jar"
    java -jar "$env:TEMP\jython-2-7-3.jar"

}
function Set-Up-PostmanProxy{
    Write-Host "Postman [2/2] - Setting up locahost:8080 proxy and disabling TLS..."
    # Define the path to the Postman executable
    $postmanPath = "$env:LOCALAPPDATA\Postman\Postman.exe"

    # Define the proxy server to use
    $proxyServer = "127.0.0.1:8080"

    # Define the SSL verification setting
    $sslVerification = "0"

    # Set the Postman environment variables for proxy and SSL verification
    Setx /M HTTP_PROXY $proxyServer
    Setx /M HTTPS_PROXY $proxyServer
    Setx /M NODE_TLS_REJECT_UNAUTHORIZED $sslVerification

    # Start Postman
    Start-Process $postmanPath
}

Install-Packages