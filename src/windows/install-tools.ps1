Write-Host " __      __  _________________________ "
Write-Host "/  \    /  \/  _  \__    ___/\_____   \"
Write-Host "\   \/\/   /  /_\  \|    |      /   __/"
Write-Host " \        /    |    \    |     |   |   "
Write-Host "  \__/\  /\____|__  /____|     |___|   "
Write-Host "       \/         \/           <___>   "
Write-Host "---------------------------------------"
Write-Host "WebApp Toolkit"
Write-Host "Use at your own risk!!!"
Write-Host "---------------------------------------"

function Install-Chrome{
    Write-Host "Installing Google Chrome latest..."
    Invoke-WebRequest "https://dl.google.com/chrome/install/latest/chrome_installer.exe" -OutFile "$env:TEMP\chrome_installer.exe"
    Start-Process -FilePath $downloadPath -ArgumentList "/silent /install" -Wait
}

function Install-JDK{
    Write-Host "Installing JDK19..."
    $jdk19 = Get-WmiObject -Class Win32_Product -filter "Vendor='Oracle Corporation'" |where Caption -clike "Java(TM) SE Development Kit 19*"
    if (!($jdk19)){
        echo "`t`tDownnloading Java JDK-19 ...."
        wget "https://download.oracle.com/java/19/latest/jdk-19_windows-x64_bin.exe" -O jdk-19.exe  
        echo "`n`t`tJDK-19 Downloaded, lets start the Installation process"
        start -wait jdk-19.exe
        rm jdk-19.exe
    }else{
        echo "Required JDK-19 is Installed"
        $jdk19
    }
}

function Install-JRE{
    Write-Host "Installing JRE8..."   
    $jre8 = Get-WmiObject -Class Win32_Product -filter "Vendor='Oracle Corporation'" |where Caption -clike "Java 8 Update *"
    if (!($jre8)){
        echo "`n`t`tDownloading Java JRE ...."
        wget "https://javadl.oracle.com/webapps/download/AutoDL?BundleId=246474_2dee051a5d0647d5be72a7c0abff270e" -O jre-8.exe
        echo "`n`t`tJRE-8 Downloaded, lets start the Installation process"
        start -wait jre-8.exe
        rm jre-8.exe
    }else{
        echo "`n`nRequired JRE-8 is Installed`n"
        $jre8
    }
}

function Install-MSCRedist{
    Write-Host "Installing MS VS Redist x64..."
    Invoke-WebRequest "https://aka.ms/vs/16/release/vc_redist.x64.exe" -OutFile "$env:TEMP\vc_redist.x64.exe"
    Start-Process -FilePath "$env:TEMP\vc_redist.x64.exe" -ArgumentList '/install /quiet /norestart' -Wait
}

function Install-WSL{
    Write-Host "Installing WSL..."
    # Enable WSL feature
    Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux
    # Enable Virtual Machine feature
    Enable-WindowsOptionalFeature -Online -FeatureName VirtualMachinePlatform

    Write-Host "Setting Up Ubuntu 20.04 LTS..."
    # Download Ubuntu 20.04 LTS from Microsoft Store
    $appName = "Ubuntu 20.04 LTS"
    $appInstaller = (Get-AppxPackage -Name $appName).InstallLocation + "\app.ico"
    if (!(Test-Path $appInstaller)) {
        (New-Object -ComObject Shell.Application).ShellExecute("ms-windows-store://pdp/?productid=9n6svws3rx71")
        Write-Output "Please download and install $appName from Microsoft Store."
        pause
    }

    # Set up Ubuntu
    $distro = "Ubuntu-20.04"
    $username = "yourusername"

    wsl --import $distro "C:\Users\$env:USERNAME\AppData\Local\Microsoft\WindowsApps\Ubuntu-20.04" --version 2
    wsl -d $distro -u root sh -c "apt update && apt upgrade -y && useradd -m $username && echo $username:password | chpasswd"
  
}

function Install-Git{
    Write-Host "Installing git..."
    Invoke-WebRequest "https://github.com/git-for-windows/git/releases/download/v2.31.1.windows.1/Git-2.31.1-64-bit.exe" -OutFile "$env:TEMP\GitInstaller.exe"
    Start-Process -FilePath "$env:TEMP\GitInstaller.exe" -ArgumentList '/VERYSILENT' -Wait
}

function Install-Golang{
    Write-Host "Installing golang..."
    Invoke-WebRequest "https://golang.org/dl/go1.17.1.windows-amd64.msi" -OutFile "$env:TEMP\GoInstaller.msi"
    Start-Process -FilePath "msiexec.exe" -ArgumentList "/i $env:TEMP\GoInstaller.msi /quiet /qn" -Wait
}

function Install-VSCode{
    Write-Host "Installing VSCode..."
    Invoke-WebRequest "https://code.visualstudio.com/sha/download?build=stable&os=win32-x64-user" -OutFile "$env:TEMP\VSCodeInstaller.exe"
    Start-Process -FilePath "$env:TEMP\VSCodeInstaller.exe" -ArgumentList '/silent' -Wait    
}

function Install-Docker{
    Write-Host "Installing Docker..."
    Invoke-WebRequest "https://download.docker.com/win/stable/Docker%20Desktop%20Installer.exe" -OutFile "$env:TEMP\DockerDesktopInstaller.exe"
    Start-Process -FilePath "$env:TEMP\DockerDesktopInstaller.exe" -ArgumentList '/quiet' -Wait
    if (!(Get-Service Docker).Status -eq 'Running') {
        # Start Docker service
        Start-Service Docker
    }
}

function Install-Postman{
    Write-Host "Postman [1/3] - Installing Postman..."
    Invoke-WebRequest "https://dl.pstmn.io/download/latest/win64" -OutFile "$env:TEMP\PostmanInstaller.exe"
    Start-Process -FilePath "$env:TEMP\PostmanInstaller.exe" -ArgumentList '/S' -Wait
    Set-Up-PostmanProxy
}

function Install-ZAP{
    Write-Host "Installing OWASP ZAP..."
    Invoke-WebRequest "https://github.com/zaproxy/zaproxy/releases/download/v2.10.0/ZAP_2.10.0_windows-x64.exe" -OutFile "$env:TEMP\ZAPInstaller.exe"
    Start-Process -FilePath "$env:TEMP\ZAPInstaller.exe" -ArgumentList '/S' -Wait
}
function Install-BurpSuiteCommunityEdition{
    Write-Host "Burp Suite Community [1/3] - Installing Burp Suite Community Edition..."
    Invoke-WebRequest "https://portswigger.net/burp/releases/download?product=community&version=2021.5.2&type=Windows" -OutFile "$env:TEMP\BurpSuiteInstaller.exe"
    Start-Process -FilePath "$env:TEMP\BurpSuiteInstaller.exe" -ArgumentList '/S' -Wait
    Set-Up-BurpSuiteCommunity
}
function Set-Up-BurpSuiteCommunity{
    Write-Host "Burp Suite Community [2/3] - Setting up Burp Suite Community..."
    # Define the path to the Burp Suite Community Edition executable
    $burpPath = "C:\Program Files\BurpSuiteCommunity\burp.exe"

    # Define the local proxy to use
    $proxyAddress = "127.0.0.1:8080"
    Write-Host "Burp Suite Community [3/3] - Installing CA Cert into Trusted Root Authorities"
    # Start Burp Suite with the specified proxy configuration
    Start-Process $burpPath "-config={""proxy.server"":""$proxyAddress""}" -Wait

    # Download Burp Suite's CA certificate to the local machine
    $certUrl = "http://burp/cert"
    $certFilePath = "$env:USERPROFILE\Desktop\burp-ca.cer"
    Invoke-WebRequest $certUrl -OutFile $certFilePath

    # Install the downloaded certificate into the local machine's trusted root store
    $cert = New-Object System.Security.Cryptography.X509Certificates.X509Certificate2
    $cert.Import($certFilePath)
    $store = New-Object System.Security.Cryptography.X509Certificates.X509Store([System.Security.Cryptography.X509Certificates.StoreName]::Root,[System.Security.Cryptography.X509Certificates.StoreLocation]::LocalMachine)
    $store.Open([System.Security.Cryptography.X509Certificates.OpenFlags]::ReadWrite)
    $store.Add($cert)
    $store.Close()
}
function Set-Up-PostmanProxy{
    Write-Host "Postman [2/2] - Setting up locahost:8080 proxy and disabling TLS..."
    # Define the path to the Postman executable
    $postmanPath = "C:\Program Files\Postman\Postman.exe"

    # Define the proxy server to use
    $proxyServer = "127.0.0.1:8080"

    # Define the SSL verification setting
    $sslVerification = "0"

    # Set the Postman environment variables for proxy and SSL verification
    Setx /M HTTP_PROXY $proxyServer
    Setx /M HTTPS_PROXY $proxyServer
    Setx /M NODE_TLS_REJECT_UNAUTHORIZED $sslVerification

    # Start Postman
    Start-Process $postmanPath
}
function Install-Tools{
    Install-MSCRedist
    Install-JRE
    Install-JDK
    Install-Chrome
    Install-WSL
    Install-Git
    Install-Golang
    Install-Docker
    Install-ZAP
    Install-Postman
    Install-BurpSuiteCommunityEdition
}

Install-Tools